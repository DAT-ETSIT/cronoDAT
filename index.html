<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Debate Electoral 2025</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0 20px;
        }
        header {
            text-align: center;
            padding: 20px;
            background-color: #f0f0f0;
        }
        header img {
            max-width: 200px;
        }
        h1 {
            text-align: center;
            margin-top: 30px;
        }

        /* Remove hover display logic */
        .inputs {
            display: none;
        }

        /* Highlight the remaining time display */
        .countdown p {
            font-size: 2em;
            font-weight: bold;
            color: #000;
            text-align: center;
            margin: 20px 0;
            cursor: pointer; /* Show it's clickable */
        }
        
        .countdown h2 {
            cursor: pointer; /* Show it's clickable */
        }

        /* Import the Mukta Maalar Bold font */
        @import url('https://fonts.googleapis.com/css2?family=Mukta+Maalar:wght@700&display=swap');

        /* Apply Mukta Maalar Bold font to the entire page */
        html, body, h1, h2, p, input, button {
            font-family: 'Mukta Maalar', sans-serif;
            font-weight: 700;
        }

        .countdown {
            border: 1px solid #ccc;
            padding: 20px;
            margin-top: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background: linear-gradient(145deg, #ffffff, #e6e6e6);
            transition: transform 0.2s;
        }

        .countdown:hover {
            transform: scale(1.02);
        }

        .countdown button {
            margin-right: 5px;
            border: none;
            color: #000;
            background: #F65555;
            padding: 8px 14px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .countdown button:hover {
            background: linear-gradient(145deg, #F65555, #FCCF31);
        }
        .inputs input {
            margin-right: 5px;
            width: 70px;
        }
        
        .edit-input {
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            width: 80%;
            padding: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <header></header>
        <img src="https://dat.etsit.upm.es/wp-content/uploads/assets_web/logo_dat_web.svg" alt="Header Image">
    </header>
    <h1>Debate Electoral 2025</h1>
    
    <!-- Button to add a new countdown card -->
    <button id="addCountdownBtn">Add Countdown</button>
    <div id="countdownsContainer"></div>

    <script>
        // Will hold all countdown objects and persist them in local storage
        function saveCountdowns() {
            const data = countdowns.map(c => ({
            id: c.countdownObj.id,
            name: c.countdownObj.name,
            remaining: c.countdownObj.remaining
            }));
            localStorage.setItem('countdowns', JSON.stringify(data));
        }
        
        function loadCountdowns() {
            const data = JSON.parse(localStorage.getItem('countdowns'));
            if (data && Array.isArray(data)) {
            data.forEach(item => {
                const { card, countdownObj } = createCountdownCard(item.id);
                countdownObj.name = item.name;
                countdownObj.remaining = item.remaining;
                
                // Append the card to the container so it is visible
                document.getElementById('countdownsContainer').appendChild(card);
                
                // Update UI elements accordingly using the card element
                card.querySelector('.countdown-name').textContent = item.name;
                card.querySelector(`#time-${item.id}`).textContent = `${Math.floor(item.remaining / 60).toString().padStart(2, '0')}:${(item.remaining % 60).toString().padStart(2, '0')}`;
                
                countdowns.push({ countdownObj });
            });
            }
        }

        let countdowns = [];
        loadCountdowns();

        // Create a new countdown card element along with its corresponding object
        function createCountdownCard(id) {
            // Object to keep track of remaining time, interval, and name
            const countdownObj = { id: id, remaining: 0, interval: null, name: "" };

            // Container for a single countdown
            const card = document.createElement('div');
            card.className = 'countdown';
            card.id = `cd-${id}`;
            
            // Name display element (initially empty) - clickable to edit
            const nameDisplay = document.createElement('h2');
            nameDisplay.className = 'countdown-name';
            nameDisplay.textContent = "Click to name";
            nameDisplay.addEventListener('click', function() {
                // Create input to replace h2
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.className = 'edit-input';
                nameInput.value = countdownObj.name || '';
                nameInput.placeholder = 'Countdown Name';
                
                // Replace h2 with input
                card.replaceChild(nameInput, nameDisplay);
                nameInput.focus();
                
                // Handle saving on blur and pressing Enter
                nameInput.addEventListener('blur', saveNameChange);
                nameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        saveNameChange();
                    }
                });
                
                function saveNameChange() {
                    const name = nameInput.value.trim();
                    countdownObj.name = name;
                    nameDisplay.textContent = name || "Click to name";
                    card.replaceChild(nameDisplay, nameInput);
                }
            });
            card.appendChild(nameDisplay);
            
            // Display element for the remaining time
            const display = document.createElement('p');
            display.id = `time-${id}`;
            display.textContent = "0m 0s";
            display.addEventListener('click', function() {
                // Create container for inputs
                const timeEditContainer = document.createElement('div');
                
                // Minutes input
                const minutesInput = document.createElement('input');
                minutesInput.type = 'number';
                minutesInput.min = 0;
                minutesInput.className = 'edit-input';
                minutesInput.value = Math.floor(countdownObj.remaining / 60);
                minutesInput.placeholder = 'Minutes';
                timeEditContainer.appendChild(minutesInput);
                
                // Seconds input
                const secondsInput = document.createElement('input');
                secondsInput.type = 'number';
                secondsInput.min = 0;
                secondsInput.max = 59;
                secondsInput.className = 'edit-input';
                secondsInput.value = countdownObj.remaining % 60;
                secondsInput.placeholder = 'Seconds';
                timeEditContainer.appendChild(secondsInput);
                
                // Save button
                const saveButton = document.createElement('button');
                saveButton.textContent = 'Set';
                saveButton.addEventListener('click', saveTimeChange);
                timeEditContainer.appendChild(saveButton);
                
                // Replace display with inputs
                card.replaceChild(timeEditContainer, display);
                minutesInput.focus();
                
                // Add event listeners for Enter key
                minutesInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        saveTimeChange();
                    }
                });
                
                secondsInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        saveTimeChange();
                    }
                });
                
                function saveTimeChange() {
                    const minutes = parseInt(minutesInput.value) || 0;
                    const seconds = parseInt(secondsInput.value) || 0;
                    countdownObj.remaining = minutes * 60 + seconds;
                    card.replaceChild(display, timeEditContainer);
                    updateDisplay(id);
                    saveCountdowns(); // Save changes to localStorage immediately
                }
            });
            card.appendChild(display);

            // Start button
            const startBtn = document.createElement('button');
            startBtn.textContent = 'Start';
            startBtn.onclick = function(){
                // Avoid starting if already running or if no time is set
                if(countdownObj.interval || countdownObj.remaining <= 0) return;
                countdownObj.interval = setInterval(function(){
                    if(countdownObj.remaining > 0) {
                        countdownObj.remaining--;
                        updateDisplay(id);
                    } else {
                        clearInterval(countdownObj.interval);
                        countdownObj.interval = null;
                        updateDisplay(id);
                    }
                }, 1000);
            };
            card.appendChild(startBtn);

            // Stop button
            const stopBtn = document.createElement('button');
            stopBtn.textContent = 'Stop';
            stopBtn.onclick = function(){
                if(countdownObj.interval) {
                    clearInterval(countdownObj.interval);
                    countdownObj.interval = null;
                }
            };
            card.appendChild(stopBtn);
            
            // Reset button
            const resetBtn = document.createElement('button');
            resetBtn.textContent = 'Reset';
            resetBtn.onclick = function(){
                clearInterval(countdownObj.interval);
                countdownObj.interval = null;
                countdownObj.remaining = 0;
                updateDisplay(id);
            };
            card.appendChild(resetBtn);
            
            // Delete button
            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'Delete';
            deleteBtn.onclick = function(){
                clearInterval(countdownObj.interval);
                // Remove from DOM
                card.remove();
                // Remove from countdowns array
                countdowns = countdowns.filter(c => c.countdownObj.id !== id);
            };
            card.appendChild(deleteBtn);
            
            return { card, countdownObj };
        }

        function updateDisplay(id) {
            const obj = countdowns.find(c => c.countdownObj.id === id);
            if (obj) {
                const display = document.getElementById(`time-${id}`);
                const mins = Math.floor(obj.countdownObj.remaining / 60);
                const secs = obj.countdownObj.remaining % 60;
                display.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
        }


        // Add a new countdown card when the button is clicked
        document.getElementById('addCountdownBtn').addEventListener('click', function(){
            const id = Date.now();
            const { card, countdownObj } = createCountdownCard(id);
            countdowns.push({ countdownObj });
            document.getElementById('countdownsContainer').appendChild(card);
        });

        window.addEventListener('beforeunload', saveCountdowns);
    </script>
</body>
</html>